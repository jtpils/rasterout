# raster_extract - Raster Extraction to point cloud / vector data for merged rgb band, tif files.

*Below shows an output of dataframe generated in mapbox map.*
![](https://cloud.githubusercontent.com/assets/10904982/14758422/1ae709b2-08cf-11e6-9b03-edff3dc60a5a.png)

Raster extract is a tool similiar to rasterio but was made with different use cases in mind like developing geospatial algorithms binding/fusing different data sets with or to raster data by using a pandas dataframe and a few functions for specific tasks. This is useful for things that require you to see and check a lot of i/o and can be integrate with other modules I've [created](https://github.com/murphy214/berrl) to view the output of a dataframe easily.

This module currently makes a few residual assumptions from how I generally use it:
  * it assumes you have only **1 tif file** and a metadatafile in the folder input argument 

The module basically consists of two main functions. 
  * generate_band_extrema(folder,extrema)
    - where folder is directory in which your tif file and metadata file is located
    - and extrema is a python dict consisting of 'n','s','e',and 'w' headings for what range of data to grab from within the image
  * make_color_table(dataframe),[**within berrl module**] this function assuming you have an output of generate_band_extrema() that has been used with the berrl function map_color_table() which simply takes its RGB output columns and combines it into a hexidecimal color hash in a new column called "COLORKEY" this can then be sent into berrl to style the points/squares accordingly
  * make_square_table() from an output containing a colorkey of generate_band_extrema() returns a list of squares that can be sent into berrl to better visualize the approximated pixel locations and sizes 



```python 
import pandas as pd
import numpy as np
import berrl as bl
import raster_extract

# setting extrema to extract data from image file
extrema = {'n':24.4,'s':24.38,'w':-77.78,'e':-77.68}

# getting data from image tif file
data = raster_extract.generate_band_extrema('meta',extrema)
print data,'generate_band_extrema output'

# mapping colorkey to table 
data = bl.map_table_colorkey(data)
print data,'colorkey added to output above so that points/squares can be styled'

# making blocks to geojson file
data2 = raster_extract.make_squares_table(data)
print data2,'blocks generated from the point output above'

# making the blocks generated into a geojson file
bl.make_blocks(data2,list=True,filename='blocks.geojson')

# loading the html and opening
bl.loadparsehtml(bl.collect(),'your mapbox apikey',colorkey='COLORKEY')

'''
OUTPUT:
        X     Y       LONG        LAT  GEOHASH  RED  GREEN  BLUE
0      6948  8895 -77.780000  24.400000  dk2dy1f  194    213   194
1      6948  8896 -77.780000  24.399859  dk2dy1f  201    216   203
2      6948  8897 -77.780000  24.399718  dk2dy1f  203    212   200
3      6948  8898 -77.780000  24.399577  dk2dy1f  205    213   201
4      6948  8899 -77.780000  24.399437  dk2dy1f  202    212   201
5      6948  8900 -77.780000  24.399296  dk2dy1f  230    233   225
6      6948  8901 -77.780000  24.399155  dk2dy1d  247    247   247
7      6948  8902 -77.780000  24.399014  dk2dy1d  247    247   247
8      6948  8903 -77.780000  24.398873  dk2dy1d  247    247   247
9      6948  8904 -77.780000  24.398732  dk2dy1d  247    247   247
10     6948  8905 -77.780000  24.398592  dk2dy1d  247    247   247
11     6948  8906 -77.780000  24.398451  dk2dy1d  247    247   247
12     6948  8907 -77.780000  24.398310  dk2dy1d  247    247   247
13     6948  8908 -77.780000  24.398169  dk2dy1d  247    247   247
14     6948  8909 -77.780000  24.398028  dk2dy1d  247    247   247
15     6948  8910 -77.780000  24.397887  dk2dy16  247    247   247
16     6948  8911 -77.780000  24.397746  dk2dy16  247    247   247
17     6948  8912 -77.780000  24.397606  dk2dy16  247    247   247
18     6948  8913 -77.780000  24.397465  dk2dy16  247    247   247
19     6948  8914 -77.780000  24.397324  dk2dy16  247    247   247
20     6948  8915 -77.780000  24.397183  dk2dy16  247    247   247
21     6948  8916 -77.780000  24.397042  dk2dy16  247    247   244
22     6948  8917 -77.780000  24.396901  dk2dy16  247    247   247
23     6948  8918 -77.780000  24.396761  dk2dy16  247    247   247
24     6948  8919 -77.780000  24.396620  dk2dy16  247    247   247
25     6948  8920 -77.780000  24.396479  dk2dy14  247    247   235
26     6948  8921 -77.780000  24.396338  dk2dy14  247    241   215
27     6948  8922 -77.780000  24.396197  dk2dy14  231    231   203
28     6948  8923 -77.780000  24.396056  dk2dy14  213    229   202
29     6948  8924 -77.780000  24.395915  dk2dy14  201    228   202
...     ...   ...        ...        ...      ...  ...    ...   ...
92889  7606  9006 -77.680303  24.384366  dk2f8r4  118    104   128
92890  7606  9007 -77.680303  24.384225  dk2f8r4  116    103   127
92891  7606  9008 -77.680303  24.384085  dk2f8qf  117    103   128
92892  7606  9009 -77.680303  24.383944  dk2f8qf  114    101   127
92893  7606  9010 -77.680303  24.383803  dk2f8qf  114    101   126
92894  7606  9011 -77.680303  24.383662  dk2f8qf  114    101   127
92895  7606  9012 -77.680303  24.383521  dk2f8qf  116    103   129
92896  7606  9013 -77.680303  24.383380  dk2f8qf  114    101   126
92897  7606  9014 -77.680303  24.383240  dk2f8qf  116    102   127
92898  7606  9015 -77.680303  24.383099  dk2f8qf  122    107   133
92899  7606  9016 -77.680303  24.382958  dk2f8qf  122    107   134
92900  7606  9017 -77.680303  24.382817  dk2f8qf  114    102   128
92901  7606  9018 -77.680303  24.382676  dk2f8qd  114    101   128
92902  7606  9019 -77.680303  24.382535  dk2f8qd  119    106   133
92903  7606  9020 -77.680303  24.382394  dk2f8qd  120    106   133
92904  7606  9021 -77.680303  24.382254  dk2f8qd  124    110   137
92905  7606  9022 -77.680303  24.382113  dk2f8qd  119    106   132
92906  7606  9023 -77.680303  24.381972  dk2f8qd  122    110   138
92907  7606  9024 -77.680303  24.381831  dk2f8qd  121    110   138
92908  7606  9025 -77.680303  24.381690  dk2f8qd  123    113   142
92909  7606  9026 -77.680303  24.381549  dk2f8qd  120    110   139
92910  7606  9027 -77.680303  24.381409  dk2f8q6  122    113   142
92911  7606  9028 -77.680303  24.381268  dk2f8q6  119    111   139
92912  7606  9029 -77.680303  24.381127  dk2f8q6  118    110   138
92913  7606  9030 -77.680303  24.380986  dk2f8q6  115    108   135
92914  7606  9031 -77.680303  24.380845  dk2f8q6  119    111   138
92915  7606  9032 -77.680303  24.380704  dk2f8q6  125    115   142
92916  7606  9033 -77.680303  24.380563  dk2f8q6  120    110   136
92917  7606  9034 -77.680303  24.380423  dk2f8q6  122    112   138
92918  7606  9035 -77.680303  24.380282  dk2f8q6  119    109   134

[92919 rows x 8 columns] generate_band_extrema output
          X     Y       LONG        LAT  GEOHASH  RED  GREEN  BLUE COLORKEY
0      6948  8895 -77.780000  24.400000  dk2dy1f  194    213   194  #c2d5c2
1      6948  8896 -77.780000  24.399859  dk2dy1f  201    216   203  #c9d8cb
2      6948  8897 -77.780000  24.399718  dk2dy1f  203    212   200  #cbd4c8
3      6948  8898 -77.780000  24.399577  dk2dy1f  205    213   201  #cdd5c9
4      6948  8899 -77.780000  24.399437  dk2dy1f  202    212   201  #cad4c9
5      6948  8900 -77.780000  24.399296  dk2dy1f  230    233   225  #e6e9e1
6      6948  8901 -77.780000  24.399155  dk2dy1d  247    247   247  #f7f7f7
7      6948  8902 -77.780000  24.399014  dk2dy1d  247    247   247  #f7f7f7
8      6948  8903 -77.780000  24.398873  dk2dy1d  247    247   247  #f7f7f7
9      6948  8904 -77.780000  24.398732  dk2dy1d  247    247   247  #f7f7f7
10     6948  8905 -77.780000  24.398592  dk2dy1d  247    247   247  #f7f7f7
11     6948  8906 -77.780000  24.398451  dk2dy1d  247    247   247  #f7f7f7
12     6948  8907 -77.780000  24.398310  dk2dy1d  247    247   247  #f7f7f7
13     6948  8908 -77.780000  24.398169  dk2dy1d  247    247   247  #f7f7f7
14     6948  8909 -77.780000  24.398028  dk2dy1d  247    247   247  #f7f7f7
15     6948  8910 -77.780000  24.397887  dk2dy16  247    247   247  #f7f7f7
16     6948  8911 -77.780000  24.397746  dk2dy16  247    247   247  #f7f7f7
17     6948  8912 -77.780000  24.397606  dk2dy16  247    247   247  #f7f7f7
18     6948  8913 -77.780000  24.397465  dk2dy16  247    247   247  #f7f7f7
19     6948  8914 -77.780000  24.397324  dk2dy16  247    247   247  #f7f7f7
20     6948  8915 -77.780000  24.397183  dk2dy16  247    247   247  #f7f7f7
21     6948  8916 -77.780000  24.397042  dk2dy16  247    247   244  #f7f7f4
22     6948  8917 -77.780000  24.396901  dk2dy16  247    247   247  #f7f7f7
23     6948  8918 -77.780000  24.396761  dk2dy16  247    247   247  #f7f7f7
24     6948  8919 -77.780000  24.396620  dk2dy16  247    247   247  #f7f7f7
25     6948  8920 -77.780000  24.396479  dk2dy14  247    247   235  #f7f7eb
26     6948  8921 -77.780000  24.396338  dk2dy14  247    241   215  #f7f1d7
27     6948  8922 -77.780000  24.396197  dk2dy14  231    231   203  #e7e7cb
28     6948  8923 -77.780000  24.396056  dk2dy14  213    229   202  #d5e5ca
29     6948  8924 -77.780000  24.395915  dk2dy14  201    228   202  #c9e4ca
...     ...   ...        ...        ...      ...  ...    ...   ...      ...
92889  7606  9006 -77.680303  24.384366  dk2f8r4  118    104   128  #766880
92890  7606  9007 -77.680303  24.384225  dk2f8r4  116    103   127  #74677f
92891  7606  9008 -77.680303  24.384085  dk2f8qf  117    103   128  #756780
92892  7606  9009 -77.680303  24.383944  dk2f8qf  114    101   127  #72657f
92893  7606  9010 -77.680303  24.383803  dk2f8qf  114    101   126  #72657e
92894  7606  9011 -77.680303  24.383662  dk2f8qf  114    101   127  #72657f
92895  7606  9012 -77.680303  24.383521  dk2f8qf  116    103   129  #746781
92896  7606  9013 -77.680303  24.383380  dk2f8qf  114    101   126  #72657e
92897  7606  9014 -77.680303  24.383240  dk2f8qf  116    102   127  #74667f
92898  7606  9015 -77.680303  24.383099  dk2f8qf  122    107   133  #7a6b85
92899  7606  9016 -77.680303  24.382958  dk2f8qf  122    107   134  #7a6b86
92900  7606  9017 -77.680303  24.382817  dk2f8qf  114    102   128  #726680
92901  7606  9018 -77.680303  24.382676  dk2f8qd  114    101   128  #726580
92902  7606  9019 -77.680303  24.382535  dk2f8qd  119    106   133  #776a85
92903  7606  9020 -77.680303  24.382394  dk2f8qd  120    106   133  #786a85
92904  7606  9021 -77.680303  24.382254  dk2f8qd  124    110   137  #7c6e89
92905  7606  9022 -77.680303  24.382113  dk2f8qd  119    106   132  #776a84
92906  7606  9023 -77.680303  24.381972  dk2f8qd  122    110   138  #7a6e8a
92907  7606  9024 -77.680303  24.381831  dk2f8qd  121    110   138  #796e8a
92908  7606  9025 -77.680303  24.381690  dk2f8qd  123    113   142  #7b718e
92909  7606  9026 -77.680303  24.381549  dk2f8qd  120    110   139  #786e8b
92910  7606  9027 -77.680303  24.381409  dk2f8q6  122    113   142  #7a718e
92911  7606  9028 -77.680303  24.381268  dk2f8q6  119    111   139  #776f8b
92912  7606  9029 -77.680303  24.381127  dk2f8q6  118    110   138  #766e8a
92913  7606  9030 -77.680303  24.380986  dk2f8q6  115    108   135  #736c87
92914  7606  9031 -77.680303  24.380845  dk2f8q6  119    111   138  #776f8a
92915  7606  9032 -77.680303  24.380704  dk2f8q6  125    115   142  #7d738e
92916  7606  9033 -77.680303  24.380563  dk2f8q6  120    110   136  #786e88
92917  7606  9034 -77.680303  24.380423  dk2f8q6  122    112   138  #7a708a
92918  7606  9035 -77.680303  24.380282  dk2f8q6  119    109   134  #776d86

[92919 rows x 9 columns] colorkey added to output above so that points/squares can be styled
       GEOHASH       LAT1      LONG1       LAT2      LONG2       LAT3  \
0      dk2dy1f  24.399859 -77.780141  24.399859 -77.779859  24.400141   
1      dk2dy1f  24.399718 -77.780141  24.399718 -77.779859  24.400000   
2      dk2dy1f  24.399577 -77.780141  24.399577 -77.779859  24.399859   
3      dk2dy1f  24.399437 -77.780141  24.399437 -77.779859  24.399718   
4      dk2dy1f  24.399296 -77.780141  24.399296 -77.779859  24.399577   
5      dk2dy1f  24.399155 -77.780141  24.399155 -77.779859  24.399437   
6      dk2dy1d  24.399014 -77.780141  24.399014 -77.779859  24.399296   
7      dk2dy1d  24.398873 -77.780141  24.398873 -77.779859  24.399155   
8      dk2dy1d  24.398732 -77.780141  24.398732 -77.779859  24.399014   
9      dk2dy1d  24.398592 -77.780141  24.398592 -77.779859  24.398873   
10     dk2dy1d  24.398451 -77.780141  24.398451 -77.779859  24.398732   
11     dk2dy1d  24.398310 -77.780141  24.398310 -77.779859  24.398592   
12     dk2dy1d  24.398169 -77.780141  24.398169 -77.779859  24.398451   
13     dk2dy1d  24.398028 -77.780141  24.398028 -77.779859  24.398310   
14     dk2dy1d  24.397887 -77.780141  24.397887 -77.779859  24.398169   
15     dk2dy16  24.397746 -77.780141  24.397746 -77.779859  24.398028   
16     dk2dy16  24.397606 -77.780141  24.397606 -77.779859  24.397887   
17     dk2dy16  24.397465 -77.780141  24.397465 -77.779859  24.397746   
18     dk2dy16  24.397324 -77.780141  24.397324 -77.779859  24.397606   
19     dk2dy16  24.397183 -77.780141  24.397183 -77.779859  24.397465   
20     dk2dy16  24.397042 -77.780141  24.397042 -77.779859  24.397324   
21     dk2dy16  24.396901 -77.780141  24.396901 -77.779859  24.397183   
22     dk2dy16  24.396761 -77.780141  24.396761 -77.779859  24.397042   
23     dk2dy16  24.396620 -77.780141  24.396620 -77.779859  24.396901   
24     dk2dy16  24.396479 -77.780141  24.396479 -77.779859  24.396761   
25     dk2dy14  24.396338 -77.780141  24.396338 -77.779859  24.396620   
26     dk2dy14  24.396197 -77.780141  24.396197 -77.779859  24.396479   
27     dk2dy14  24.396056 -77.780141  24.396056 -77.779859  24.396338   
28     dk2dy14  24.395915 -77.780141  24.395915 -77.779859  24.396197   
29     dk2dy14  24.395775 -77.780141  24.395775 -77.779859  24.396056   
...        ...        ...        ...        ...        ...        ...   
92889  dk2f8r4  24.384225 -77.680444  24.384225 -77.680162  24.384507   
92890  dk2f8r4  24.384085 -77.680444  24.384085 -77.680162  24.384366   
92891  dk2f8qf  24.383944 -77.680444  24.383944 -77.680162  24.384225   
92892  dk2f8qf  24.383803 -77.680444  24.383803 -77.680162  24.384085   
92893  dk2f8qf  24.383662 -77.680444  24.383662 -77.680162  24.383944   
92894  dk2f8qf  24.383521 -77.680444  24.383521 -77.680162  24.383803   
92895  dk2f8qf  24.383380 -77.680444  24.383380 -77.680162  24.383662   
92896  dk2f8qf  24.383240 -77.680444  24.383240 -77.680162  24.383521   
92897  dk2f8qf  24.383099 -77.680444  24.383099 -77.680162  24.383380   
92898  dk2f8qf  24.382958 -77.680444  24.382958 -77.680162  24.383240   
92899  dk2f8qf  24.382817 -77.680444  24.382817 -77.680162  24.383099   
92900  dk2f8qf  24.382676 -77.680444  24.382676 -77.680162  24.382958   
92901  dk2f8qd  24.382535 -77.680444  24.382535 -77.680162  24.382817   
92902  dk2f8qd  24.382394 -77.680444  24.382394 -77.680162  24.382676   
92903  dk2f8qd  24.382254 -77.680444  24.382254 -77.680162  24.382535   
92904  dk2f8qd  24.382113 -77.680444  24.382113 -77.680162  24.382394   
92905  dk2f8qd  24.381972 -77.680444  24.381972 -77.680162  24.382254   
92906  dk2f8qd  24.381831 -77.680444  24.381831 -77.680162  24.382113   
92907  dk2f8qd  24.381690 -77.680444  24.381690 -77.680162  24.381972   
92908  dk2f8qd  24.381549 -77.680444  24.381549 -77.680162  24.381831   
92909  dk2f8qd  24.381409 -77.680444  24.381409 -77.680162  24.381690   
92910  dk2f8q6  24.381268 -77.680444  24.381268 -77.680162  24.381549   
92911  dk2f8q6  24.381127 -77.680444  24.381127 -77.680162  24.381409   
92912  dk2f8q6  24.380986 -77.680444  24.380986 -77.680162  24.381268   
92913  dk2f8q6  24.380845 -77.680444  24.380845 -77.680162  24.381127   
92914  dk2f8q6  24.380704 -77.680444  24.380704 -77.680162  24.380986   
92915  dk2f8q6  24.380563 -77.680444  24.380563 -77.680162  24.380845   
92916  dk2f8q6  24.380423 -77.680444  24.380423 -77.680162  24.380704   
92917  dk2f8q6  24.380282 -77.680444  24.380282 -77.680162  24.380563   
92918  dk2f8q6  24.380141 -77.680444  24.380141 -77.680162  24.380423   

           LONG3       LAT4      LONG4  RED  GREEN  BLUE COLORKEY  
0     -77.780141  24.400141 -77.779859  194    213   194  #c2d5c2  
1     -77.780141  24.400000 -77.779859  201    216   203  #c9d8cb  
2     -77.780141  24.399859 -77.779859  203    212   200  #cbd4c8  
3     -77.780141  24.399718 -77.779859  205    213   201  #cdd5c9  
4     -77.780141  24.399577 -77.779859  202    212   201  #cad4c9  
5     -77.780141  24.399437 -77.779859  230    233   225  #e6e9e1  
6     -77.780141  24.399296 -77.779859  247    247   247  #f7f7f7  
7     -77.780141  24.399155 -77.779859  247    247   247  #f7f7f7  
8     -77.780141  24.399014 -77.779859  247    247   247  #f7f7f7  
9     -77.780141  24.398873 -77.779859  247    247   247  #f7f7f7  
10    -77.780141  24.398732 -77.779859  247    247   247  #f7f7f7  
11    -77.780141  24.398592 -77.779859  247    247   247  #f7f7f7  
12    -77.780141  24.398451 -77.779859  247    247   247  #f7f7f7  
13    -77.780141  24.398310 -77.779859  247    247   247  #f7f7f7  
14    -77.780141  24.398169 -77.779859  247    247   247  #f7f7f7  
15    -77.780141  24.398028 -77.779859  247    247   247  #f7f7f7  
16    -77.780141  24.397887 -77.779859  247    247   247  #f7f7f7  
17    -77.780141  24.397746 -77.779859  247    247   247  #f7f7f7  
18    -77.780141  24.397606 -77.779859  247    247   247  #f7f7f7  
19    -77.780141  24.397465 -77.779859  247    247   247  #f7f7f7  
20    -77.780141  24.397324 -77.779859  247    247   247  #f7f7f7  
21    -77.780141  24.397183 -77.779859  247    247   244  #f7f7f4  
22    -77.780141  24.397042 -77.779859  247    247   247  #f7f7f7  
23    -77.780141  24.396901 -77.779859  247    247   247  #f7f7f7  
24    -77.780141  24.396761 -77.779859  247    247   247  #f7f7f7  
25    -77.780141  24.396620 -77.779859  247    247   235  #f7f7eb  
26    -77.780141  24.396479 -77.779859  247    241   215  #f7f1d7  
27    -77.780141  24.396338 -77.779859  231    231   203  #e7e7cb  
28    -77.780141  24.396197 -77.779859  213    229   202  #d5e5ca  
29    -77.780141  24.396056 -77.779859  201    228   202  #c9e4ca  
...          ...        ...        ...  ...    ...   ...      ...  
92889 -77.680444  24.384507 -77.680162  118    104   128  #766880  
92890 -77.680444  24.384366 -77.680162  116    103   127  #74677f  
92891 -77.680444  24.384225 -77.680162  117    103   128  #756780  
92892 -77.680444  24.384085 -77.680162  114    101   127  #72657f  
92893 -77.680444  24.383944 -77.680162  114    101   126  #72657e  
92894 -77.680444  24.383803 -77.680162  114    101   127  #72657f  
92895 -77.680444  24.383662 -77.680162  116    103   129  #746781  
92896 -77.680444  24.383521 -77.680162  114    101   126  #72657e  
92897 -77.680444  24.383380 -77.680162  116    102   127  #74667f  
92898 -77.680444  24.383240 -77.680162  122    107   133  #7a6b85  
92899 -77.680444  24.383099 -77.680162  122    107   134  #7a6b86  
92900 -77.680444  24.382958 -77.680162  114    102   128  #726680  
92901 -77.680444  24.382817 -77.680162  114    101   128  #726580  
92902 -77.680444  24.382676 -77.680162  119    106   133  #776a85  
92903 -77.680444  24.382535 -77.680162  120    106   133  #786a85  
92904 -77.680444  24.382394 -77.680162  124    110   137  #7c6e89  
92905 -77.680444  24.382254 -77.680162  119    106   132  #776a84  
92906 -77.680444  24.382113 -77.680162  122    110   138  #7a6e8a  
92907 -77.680444  24.381972 -77.680162  121    110   138  #796e8a  
92908 -77.680444  24.381831 -77.680162  123    113   142  #7b718e  
92909 -77.680444  24.381690 -77.680162  120    110   139  #786e8b  
92910 -77.680444  24.381549 -77.680162  122    113   142  #7a718e  
92911 -77.680444  24.381409 -77.680162  119    111   139  #776f8b  
92912 -77.680444  24.381268 -77.680162  118    110   138  #766e8a  
92913 -77.680444  24.381127 -77.680162  115    108   135  #736c87  
92914 -77.680444  24.380986 -77.680162  119    111   138  #776f8a  
92915 -77.680444  24.380845 -77.680162  125    115   142  #7d738e  
92916 -77.680444  24.380704 -77.680162  120    110   136  #786e88  
92917 -77.680444  24.380563 -77.680162  122    112   138  #7a708a  
92918 -77.680444  24.380423 -77.680162  119    109   134  #776d86  

[92919 rows x 13 columns] blocks generated from the point output above
'''
```
